<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Signup</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: #fafafa; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
        }
        .container { 
            display: flex; 
            max-width: 935px; 
            width: 100%; 
            padding: 20px; 
        }
        .left { 
            flex: 1; 
            text-align: center; 
        } 
        .phone-img { 
            max-width: 454px; 
            margin: 0 auto; 
        }
        .right { 
            flex: 1; 
            padding: 40px; 
        } 
        .logo { 
            font-size: 48px; 
            color: #262626; 
            margin-bottom: 32px; 
            font-family: cursive; 
        }
        .form { 
            background: #fff; 
            border: 1px solid #dbdbdb; 
            border-radius: 4px; 
            padding: 40px; 
            text-align: center; 
        }
        input, select { 
            width: 100%; 
            padding: 9px; 
            border: 1px solid #efefef; 
            border-radius: 3px; 
            background: #fafafa; 
            margin-bottom: 6px; 
            box-sizing: border-box; 
        }
        input:focus, select:focus { 
            border-color: #b2b2b2; 
            background: #fff; 
            outline: none; 
        }
        .btn { 
            width: 100%; 
            background: #0095f6; 
            color: #fff; 
            border: none; 
            border-radius: 5px; 
            padding: 7px; 
            font-weight: 600; 
            cursor: pointer; 
            margin: 8px 0; 
        }
        .btn:hover { 
            background: #1877f2; 
        }
        .message { 
            font-size: 12px; 
            margin-top: 10px; 
            padding: 10px; 
            border-radius: 3px; 
            text-align: center; 
            display: none; 
        }
        .error { 
            background: #fdf2f2; 
            color: #ed4956; 
            border: 1px solid #ed4956; 
        }
        .success { 
            background: #e7f3ff; 
            color: #0095f6; 
            border: 1px solid #0095f6; 
        }
        .link-btn { 
            background: #0095f6; 
            color: #fff; 
            padding: 10px 20px; 
            border-radius: 5px; 
            text-decoration: none; 
            display: block; 
            margin: 10px auto; 
            width: fit-content; 
            font-weight: 600; 
        }
        .link-btn:hover { 
            background: #1877f2; 
        }
        .login-link { 
            color: #262626; 
            margin-top: 20px; 
        } 
        .login-link a { 
            color: #0095f6; 
            text-decoration: none; 
        }
        .birthday-row { 
            display: flex; 
            gap: 5px; 
        } 
        .birthday-row select { 
            flex: 1; 
        }
        @media (max-width: 875px) { 
            .container { flex-direction: column; } 
            .left { display: none; } 
            .right { padding: 20px; } 
            .birthday-row { flex-direction: column; } 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left">
            <img src="https://www.instagram.com/static/images/homepage/phones/homepage-phones.png/0da79f2b71a8.png" alt="Instagram Phones" class="phone-img">
        </div>
        <div class="right">
            <div class="logo">Instagram</div>
            <div class="form">
                <form id="signupForm">
                    <input type="email" id="email" placeholder="Email" required>
                    <input type="text" id="fullName" placeholder="Full Name" required>
                    <input type="text" id="username" placeholder="Username" required>
                    <input type="password" id="password" placeholder="Password" required>
                    <div class="birthday-row">
                        <select id="birthMonth" required>
                            <option value="">Month</option>
                        </select>
                        <select id="birthDay" required>
                            <option value="">Day</option>
                        </select>
                        <select id="birthYear" required>
                            <option value="">Year</option>
                        </select>
                    </div>
                    <input type="hidden" id="birthday" required> <!-- Hidden for YYYY-MM-DD format -->
                    <button type="submit" class="btn">Sign Up</button>
                    <div id="message" class="message"></div>
                </form>
                <p class="login-link">Have an account? <a href="login.html">Log in</a></p>
            </div>
        </div>
    </div>
    <script>
        // Full population of dropdowns
        const monthSelect = document.getElementById('birthMonth');
        const daySelect = document.getElementById('birthDay');
        const yearSelect = document.getElementById('birthYear');
        const birthdayHidden = document.getElementById('birthday');

        // Months (01-12 with full names for better UX)
        const months = [
            { value: '01', text: 'January' },
            { value: '02', text: 'February' },
            { value: '03', text: 'March' },
            { value: '04', text: 'April' },
            { value: '05', text: 'May' },
            { value: '06', text: 'June' },
            { value: '07', text: 'July' },
            { value: '08', text: 'August' },
            { value: '09', text: 'September' },
            { value: '10', text: 'October' },
            { value: '11', text: 'November' },
            { value: '12', text: 'December' }
        ];
        months.forEach(month => {
            const option = document.createElement('option');
            option.value = month.value;
            option.textContent = month.text;
            monthSelect.appendChild(option);
        });

        // Days (01-31)
        for (let day = 1; day <= 31; day++) {
            const option = document.createElement('option');
            option.value = day.toString().padStart(2, '0');
            option.textContent = day.toString();
            daySelect.appendChild(option);
        }

        // Years (1900 to current year)
        const currentYear = new Date().getFullYear();
        for (let year = currentYear; year >= 1900; year--) {
            const option = document.createElement('option');
            option.value = year.toString();
            option.textContent = year.toString();
            yearSelect.appendChild(option);
        }

        // Update hidden birthday field when any dropdown changes
        function updateBirthday() {
            const year = yearSelect.value;
            const month = monthSelect.value;
            const day = daySelect.value;

            if (year && month && day) {
                const birthdayStr = `${year}-${month}-${day}`;
                // Basic validation: Not a future date
                const birthdayDate = new Date(birthdayStr);
                if (birthdayDate > new Date()) {
                    birthdayHidden.value = ''; // Invalid
                    console.warn('Birthday cannot be in the future');
                    return false;
                }
                birthdayHidden.value = birthdayStr;
                console.log('Birthday updated:', birthdayStr); // Debug log
                return true;
            } else {
                birthdayHidden.value = '';
                return false;
            }
        }

        // Attach change listeners to all dropdowns
        [monthSelect, daySelect, yearSelect].forEach(select => {
            select.addEventListener('change', updateBirthday);
        });

        // Form submission with improved validation
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault(); // Prevents page reload

            const email = document.getElementById('email').value.trim();
            const fullName = document.getElementById('fullName').value.trim();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const birthday = birthdayHidden.value;
            const messageDiv = document.getElementById('message');
            messageDiv.style.display = 'none';

            // Client-side validation
            if (!email || !fullName || !username || !password || !birthday) {
                messageDiv.textContent = 'Please fill all fields, including birthday.';
                messageDiv.className = 'error message';
                messageDiv.style.display = 'block';
                return;
            }
            if (password.length < 6) {
                messageDiv.textContent = 'Password must be at least 6 characters.';
                messageDiv.className = 'error message';
                messageDiv.style.display = 'block';
                return;
            }
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                messageDiv.textContent = 'Invalid email format.';
                messageDiv.className = 'error message';
                messageDiv.style.display = 'block';
                return;
            }
            if (!updateBirthday()) {
                messageDiv.textContent = 'Please select a valid birthday (not in the future).';
                messageDiv.className = 'error message';
                messageDiv.style.display = 'block';
                return;
            }

            try {
                const res = await fetch('/api/signup', {  // AJAX to backend
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, fullName, username, password, birthday })
                });
                const data = await res.json();

                if (data.success) {
                    messageDiv.innerHTML = `${data.message} <br> <a href="mywebsite.html" class="link-btn">Go to My Website</a>`; // Separate link
                    messageDiv.className = 'success message';
                    messageDiv.style.display = 'block';
                    document.getElementById('signupForm').reset(); // Clear form
                    // Reset dropdowns
                    monthSelect.value = ''; daySelect.value = ''; yearSelect.value = ''; birthdayHidden.value = '';
                    setTimeout(() => window.location.href = 'login.html', 3000); // Auto-redirect to login
                } else {
                    messageDiv.textContent = data.error || 'Signup failed.';
                    messageDiv.className = 'error message';
                    messageDiv.style.display = 'block';
                }
            } catch (err) {
                messageDiv.textContent = 'Network error. Check if server is running.';
                messageDiv.className = 'error message';
                messageDiv.style.display = 'block';
                console.error('Signup error:', err); // Check browser console (F12)
            }
        });
    </script>
</body>
</html>
